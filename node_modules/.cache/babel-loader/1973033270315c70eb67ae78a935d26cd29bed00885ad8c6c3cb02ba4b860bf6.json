{"ast":null,"code":"function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nimport '@github/text-expander-element';\nfunction text_expand_pls() {\n  // TODO: querySelectorAll\n  var expander = document.querySelector('text-expander');\n  if (!!expander) {\n    expander.addEventListener('text-expander-change', function (event) {\n      var _event$detail = event.detail,\n        key = _event$detail.key,\n        provide = _event$detail.provide,\n        text = _event$detail.text;\n      if (key === '#') {\n        fetch_textexpand_menu(\"_tags\", text, provide);\n      } else if (key == \"@\") {\n        fetch_textexpand_menu(\"_contacts\", text, provide);\n      } else if (key == \"[[\") {\n        fetch_textexpand_menu(\"_subjects\", text, provide);\n      } else if (key == \":\") {\n        fetch_textexpand_menu(\"_emoji\", text, provide);\n      }\n    });\n    expander.addEventListener('text-expander-value', function (event) {\n      var _event$detail2 = event.detail,\n        key = _event$detail2.key,\n        item = _event$detail2.item;\n      if (key === '#') {\n        event.detail.value = item.textContent;\n      } else if (key == '@') {\n        event.detail.value = \"@\".concat(item.textContent);\n      } else if (key == \"[[\") {\n        event.detail.value = \"[[\".concat(item.identifier, \"]]\");\n      } else if (key == \":\") {\n        event.detail.value = item.identifier;\n      }\n    });\n  }\n}\nfunction fetch_textexpand_menu(type, text, callback) {\n  var nwo = window.current_nwo.name;\n  var query = encodeURIComponent(text);\n\n  // TODO: dear LORD clean this up, catch errors, etc\n  callback(fetch(\"/\".concat(nwo, \"/\").concat(type, \"/\").concat(query)).then(function (response) {\n    return response.json();\n  }).then(function (data) {\n    var menu;\n    if (type == \"_subjects\") {\n      menu = suggestion_menu(data, \"identifier\", \"subject\");\n    } else {\n      menu = suggestion_menu(data);\n    }\n    return {\n      matched: data.length > 0,\n      fragment: menu\n    };\n  }));\n}\nfunction suggestion_menu(collection) {\n  var id_attr = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"id\";\n  var label_attr = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"name\";\n  var menu = document.createElement('ul');\n  menu.role = 'listbox';\n  menu.classList.add(\"suggester\");\n  menu.classList.add(\"suggester-container\");\n  menu.classList.add(\"list-style-none\");\n  var _iterator = _createForOfIteratorHelper(collection),\n    _step;\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var member = _step.value;\n      var item = document.createElement('li');\n      item.setAttribute('role', 'option');\n      item.textContent = member[label_attr];\n      item.identifier = member[id_attr];\n      item.id = \"option-\".concat(member[id_attr]);\n      menu.append(item);\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n  return menu;\n}\ndocument.addEventListener(\"turbolinks:load\", function () {\n  text_expand_pls();\n});","map":{"version":3,"names":["text_expand_pls","expander","document","querySelector","addEventListener","event","_event$detail","detail","key","provide","text","fetch_textexpand_menu","_event$detail2","item","value","textContent","concat","identifier","type","callback","nwo","window","current_nwo","name","query","encodeURIComponent","fetch","then","response","json","data","menu","suggestion_menu","matched","length","fragment","collection","id_attr","arguments","undefined","label_attr","createElement","role","classList","add","_iterator","_createForOfIteratorHelper","_step","s","n","done","member","setAttribute","id","append","err","e","f"],"sources":["/Users/phillmv/code/archive/app/javascript/text_expanding.js"],"sourcesContent":["import '@github/text-expander-element';\n\nfunction text_expand_pls(){\n  // TODO: querySelectorAll\n  const expander = document.querySelector('text-expander')\n\n  if(!!expander) {\n    expander.addEventListener('text-expander-change', event => {\n      const {key, provide, text} = event.detail\n\n      if (key === '#') {\n        fetch_textexpand_menu(\"_tags\", text, provide)\n      } else if (key == \"@\") {\n        fetch_textexpand_menu(\"_contacts\", text, provide)\n      } else if (key == \"[[\") {\n        fetch_textexpand_menu(\"_subjects\", text, provide);\n      } else if (key == \":\") {\n        fetch_textexpand_menu(\"_emoji\", text, provide);\n      }\n    });\n\n    expander.addEventListener('text-expander-value', function(event) {\n      const {key, item}  = event.detail\n      if (key === '#') {\n        event.detail.value = item.textContent\n      } else if (key == '@') {\n        event.detail.value = `@${item.textContent}`\n      } else if (key == \"[[\") {\n        event.detail.value = `[[${item.identifier}]]`\n      } else if (key == \":\") {\n        event.detail.value = item.identifier\n      }\n    });\n\n  }\n}\n\nfunction fetch_textexpand_menu(type, text, callback) {\n  var nwo = window.current_nwo.name\n  var query = encodeURIComponent(text)\n\n  // TODO: dear LORD clean this up, catch errors, etc\n  callback(\n    fetch(`/${nwo}/${type}/${query}`).\n    then( response => response.json() ).\n    then( data => {\n      var menu;\n      if (type == \"_subjects\") {\n        menu = suggestion_menu(data, \"identifier\", \"subject\")\n      }\n      else  {\n        menu = suggestion_menu(data)\n      }\n      return {matched: data.length > 0, fragment: menu};\n    })\n  );\n}\n\nfunction suggestion_menu(collection, id_attr = \"id\", label_attr = \"name\") {\n  const menu = document.createElement('ul')\n  menu.role = 'listbox'\n  menu.classList.add(\"suggester\")\n  menu.classList.add(\"suggester-container\")\n  menu.classList.add(\"list-style-none\")\n  for (const member of collection) {\n    const item = document.createElement('li')\n    item.setAttribute('role', 'option')\n    item.textContent = member[label_attr]\n    item.identifier = member[id_attr]\n    item.id = `option-${member[id_attr]}`\n    menu.append(item)\n  }\n\n  return menu\n}\n\n\ndocument.addEventListener(\"turbolinks:load\", function(){\n  text_expand_pls();\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}